(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9264],{35067:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>g});var r=a(95155),n=a(12115),l=a(10851),s=a(14932),i=a(82507),d=a(64271),c=a(47202),o=a(11625),u=a(6675),p=a(82378);a(33174);var m=a(49509);let h={fr:p.A},v=(0,s.Hz)({format:i.A,parse:d.A,startOfWeek:c.A,getDay:o.A,locales:h}),x=(0,l.UU)(m.env.NEXT_PUBLIC_SUPABASE_URL,m.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);function g(){let[e,t]=(0,n.useState)(""),[a,l]=(0,n.useState)([]),[i,d]=(0,n.useState)([]),[c,o]=(0,n.useState)({date:"",heure:"",duree:"",recurrence:1}),[p,m]=(0,n.useState)(""),[h,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{let{data:{user:e}}=await x.auth.getUser();if(e){t(e.id);let{data:a}=await x.from("eleves").select("*").eq("tuteur_id",e.id);l(a||[]);let{data:r}=await x.from("seances").select("*").eq("tuteur_id",e.id);d(r||[])}})()},[]);let _=async()=>{if(!p||!c.date||!c.heure||!c.duree){alert("Champs manquants");return}try{let t=a.find(e=>e.id===p);if(!(null==t?void 0:t.lien_lessonspace)){alert("Le lien Lessonspace de l'\xe9l\xe8ve est manquant. Ajoutez-le dans Supabase.");return}let{error:r}=await x.from("seances").insert({tuteur_id:e,eleve_id:p,date:c.date,heure:c.heure,duree:c.duree,lien_lessonspace:t.lien_lessonspace,eleve_nom:"".concat((null==t?void 0:t.prenom)||""," ").concat((null==t?void 0:t.nom)||""),accedee:!1,lien_revoir:null,completee:!1});if(r){alert("Erreur Supabase : ".concat(r.message));return}alert("S\xe9ance ajout\xe9e!"),location.reload()}catch(e){alert("Erreur inattendue : "+e.message)}},b=async()=>{(null==h?void 0:h.id)&&(await x.from("seances").delete().eq("id",h.id),alert("S\xe9ance supprim\xe9e"),location.reload())},f=async()=>{let e=prompt("Entrez la dur\xe9e r\xe9elle (en minutes):");if(!(!e||isNaN(e)))try{var t;let a=await fetch("/api/lessonspace/replay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({space_id:null===(t=h.lien)||void 0===t?void 0:t.split("/").pop()})}),r=await a.json();if(!a.ok||!r.replay_url){alert("Erreur Lessonspace : ".concat(a.status," - ").concat(JSON.stringify(r)));return}await x.from("seances").update({completee:!0,duree_reelle:parseInt(e),lien_revoir:r.replay_url}).eq("id",h.id),alert("S\xe9ance compl\xe9t\xe9e avec enregistrement!"),location.reload()}catch(e){alert("Erreur inattendue : "+e.message)}},j=async()=>{(null==h?void 0:h.id)&&(await x.from("seances").update({accedee:!0}).eq("id",h.id),window.open(h.lien,"_blank"),location.reload())};return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-xl font-bold mb-4",children:"Ajouter une s\xe9ance"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,r.jsxs)("select",{onChange:e=>m(e.target.value),className:"p-2 border rounded",children:[(0,r.jsx)("option",{value:"",children:"S\xe9lectionner un \xe9l\xe8ve"}),a.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom]},e.id))]}),(0,r.jsx)("input",{type:"date",onChange:e=>o({...c,date:e.target.value}),className:"p-2 border rounded"}),(0,r.jsx)("input",{type:"time",onChange:e=>o({...c,heure:e.target.value}),className:"p-2 border rounded"}),(0,r.jsx)("input",{type:"number",placeholder:"Dur\xe9e (min)",onChange:e=>o({...c,duree:e.target.value}),className:"p-2 border rounded"})]}),(0,r.jsx)("button",{onClick:_,className:"bg-green-600 text-white px-4 py-2 rounded",children:"Ajouter"}),(0,r.jsx)("h2",{className:"text-lg font-semibold mt-8 mb-2",children:"Calendrier"}),(0,r.jsx)(s.Vv,{localizer:v,events:i.map(e=>({id:e.id,title:"S\xe9ance",start:new Date("".concat(e.date,"T").concat(e.heure)),end:(0,u.A)(new Date("".concat(e.date,"T").concat(e.heure)),parseInt(e.duree)),lien:e.lien_lessonspace,accedee:e.accedee,lien_revoir:e.lien_revoir,completee:e.completee})),startAccessor:"start",endAccessor:"end",style:{height:500},onSelectEvent:e=>{g(e)},defaultView:s.Pp.WEEK}),h&&(0,r.jsxs)("div",{className:"mt-4 border p-4 rounded bg-gray-50",children:[(0,r.jsx)("h3",{className:"font-bold mb-2",children:"S\xe9ance s\xe9lectionn\xe9e"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[!h.completee&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:j,className:"bg-blue-500 text-white px-3 py-1 rounded",children:"Acc\xe9der"}),h.accedee&&(0,r.jsx)("button",{onClick:f,className:"bg-green-500 text-white px-3 py-1 rounded",children:"Compl\xe9ter"}),(0,r.jsx)("button",{onClick:b,className:"bg-red-500 text-white px-3 py-1 rounded",children:"Supprimer"})]}),h.accedee&&h.completee&&h.lien_revoir&&(0,r.jsx)("a",{href:h.lien_revoir,target:"_blank",rel:"noreferrer",children:(0,r.jsx)("button",{className:"bg-purple-500 text-white px-3 py-1 rounded",children:"Revoir"})})]})]})]})}},41399:(e,t,a)=>{Promise.resolve().then(a.bind(a,35067))}},e=>{var t=t=>e(e.s=t);e.O(0,[6431,9586,851,2507,372,8441,1684,7358],()=>t(41399)),_N_E=e.O()}]);